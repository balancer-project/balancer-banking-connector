version: '3.8'
name: balancer-banking-connector
services:
  db:
    hostname: db
    image: postgres:15-alpine
    ports:
      - '5432:5432'
    environment:
      - POSTGRES_USER=banking-connector
      - POSTGRES_PASSWORD=local-dev
      - POSTGRES_DB=banking-connector-db
  wiremock:
    hostname: wiremock
    image: wiremock/wiremock:2.35.0-alpine
    ports:
      - '8443:8443'
      - '8444:8444'
    volumes:
      - ../../code/boot/src/test/resources/wiremock/:/home/wiremock
    command:
      - --port=8443
      - --https-port=8444
      - --global-response-templating
  rabbitmq:
    container_name: rabbitmq
    image: rabbitmq:3.12-management-alpine
    ports:
      - '5672:5672'
      - '15672:15672'
    environment:
      RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS: -rabbitmq_management load_definitions "/etc/rabbitmq/definitions.json"
    volumes:
      - $PWD/local-dev/rabbitmq/definitions.json:/etc/rabbitmq/definitions.json
  jenkins:
    image: jenkins/jenkins:lts-jdk11
    privileged: true
    user: root
    ports:
      - 8081:8080
      - 50000:50000
    container_name: jenkins
    volumes:
      - ./local-dev/jenkins/:/var/jenkins_home
      - /var/run/docker.sock:/var/run/docker.sock
  jenkins_agent:
    image: jenkins/ssh-agent:latest-alpine3.18
    privileged: true
    user: root
    container_name: jenkins_agent
    volumes:
      - /tmp:/tmp
      - /var/run/docker.sock:/var/run/docker.sock
    expose:
      - 22
    platform: linux/x86_64
    environment:
      - JENKINS_AGENT_SSH_PUBKEY=<add_pub_key>